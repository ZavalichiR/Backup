package clientserver;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.io.PrintWriter;
import java.net.ServerSocket;
import java.net.Socket;

public class MyEchoServer {

    public static void main(String[] args) throws IOException {

        ServerSocket ss = new ServerSocket(5678); 

        //try {
            while(true) {
                final Socket s = ss.accept();
                new Thread() {
                    public void run() {
                        //try {
                            
                            PrintWriter socketWriter = new PrintWriter(s.getOutputStream(), true);          
                            BufferedReader socketReader = new BufferedReader(new InputStreamReader(s.getInputStream()));
                            socketWriter.println("Welcome to MyServer!");                          
                            String line;
                            while(!(line = socketReader.readLine()).equals("bye")) {
                                System.out.println("[CLIENT " + ss.getLocalSocketAddress().toString() + "] " + line);
                                socketWriter.println("[SERVER] " + line);
                        //    }
                            socketWriter.println("bye");
                        //} catch (IOException e) {
                        //    e.printStackTrace();
                        }
                        //finally {
                          //  try {
                                s.close();
                            //} catch (IOException e) {
                            //    e.printStackTrace();
                            //}
                        }
                    }
                }.start();
            }
        //}
        //catch(Exception e) {
        //    e.printStackTrace();
        //}
        //finally {
            ss.close();
        //}
    }
}